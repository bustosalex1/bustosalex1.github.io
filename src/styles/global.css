@import "tailwindcss";
@plugin '@tailwindcss/typography';

/*
* `prose-inline-code:` selector for only selecting inline code (instead of also
* selecting code blocks) in typography `prose` blocks.
*/
@custom-variant prose-inline-code (&.prose :where(:not(pre)>code):not(:where([class~="not-prose"] *)));

/* Light theme colors. */
:root {
    color-scheme: light;
    --bg-color: oklch(0.9635 0.0045 258.32);
    --bg-secondary-color: oklch(0.9819 0.0029 264.54);
    --bg-figure-color: oklch(0.9435 0.0045 258.32);
    --ink-color: oklch(0.2303 0.0125 264.29);
    --ink-secondary-color: oklch(0.4236 0.0158 266.54);
    --ink-tertiary-color: oklch(0.5927 0.0145 266.63);
    --line-color: oklch(0.8168 0.0133 266.68);
    --line-secondary-color: oklch(0.8912 0.0101 267.35);
    --primary-color: oklch(75.461% 0.183 346.812);
    --diagonal-lines-svg: url("data:image/svg+xml,%3Csvg width='6' height='6' viewBox='0 0 6 6' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='%23cecece' fill-opacity='0.4' fill-rule='evenodd'%3E%3Cpath d='M5 0h1L0 6V5zM6 5v1H5z'/%3E%3C/g%3E%3C/svg%3E");
}

/* Dark theme colors. */
[data-theme="dark"] {
    color-scheme: dark;
    --bg-color: oklch(0.1993 0.0068 258.37);
    --bg-secondary-color: oklch(0.2383 0.0106 260.69);
    --bg-figure-color: oklch(0.2383 0.0106 260.69);
    --ink-color: oklch(0.8886 0.0085 271.32);
    --ink-secondary-color: oklch(0.6992 0.0153 268.44);
    --ink-tertiary-color: oklch(0.5134 0.015 266.6);
    --line-color: oklch(0.364 0.0181 268.19);
    --line-secondary-color: oklch(0.3169 0.017 266.41);
    --primary-color: oklch(78% 0.18 346.812);
    --diagonal-lines-svg: url("data:image/svg+xml,%3Csvg width='6' height='6' viewBox='0 0 6 6' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='%23636770' fill-opacity='0.25' fill-rule='evenodd'%3E%3Cpath d='M5 0h1L0 6V5zM6 5v1H5z'/%3E%3C/g%3E%3C/svg%3E");
}

@theme inline {
    --color-bg: var(--bg-color);
    --color-secondary-bg: var(--bg-secondary-color);
    --color-figure-bg: var(--bg-figure-color);
    --color-ink: var(--ink-color);
    --color-ink-secondary: var(--ink-secondary-color);
    --color-ink-tertiary: var(--ink-tertiary-color);
    --color-line: var(--line-color);
    --color-line-secondary: var(--line-secondary-color);
    --color-primary: var(--primary-color);

    --font-crimson: "Crimson Text", serif;
    --font-mono: "Fira Code", mono;
}

@utility diagonal-lines {
    background-image: var(--diagonal-lines-svg);
}

@utility text-shadow-hero {
    text-shadow: 0 2px 16px rgba(0, 0, 0, 0.5);
}

@utility text-shadow-soft {
    text-shadow: 0 1px 8px rgba(0, 0, 0, 0.4);
}

/* Some styling for KaTeX sections. */
.katex-display {
    overflow: auto hidden;
}

/* Article styling rules */
.prose {
    counter-reset: section subsection figure table;

    & :where(figure) {
        @apply mx-auto bg-figure-bg my-0 py-0 flex flex-col justify-center border-y border-line;
        line-height: 0;
    }

    & :where(figure img) {
        @apply max-h-[75vh] w-auto my-0 mx-auto;
    }

    & :where(figcaption) {
        counter-increment: figure;
        @apply font-mono text-sm text-left m-0 p-2 text-ink border-t border-line bg-bg;

        &::before {
            content: "Figure " counter(figure, decimal) ". ";
            @apply text-ink-secondary;
        }
    }

    & :where(blockquote) {
        @apply font-mono text-sm text-ink not-italic border-none px-10 mx-auto w-fit;
        quotes: none;
    }

    & :where(blockquote p) {
        @apply text-left;
    }

    & :where(h1, h2, h3, h4, h5, h6) {
        @apply font-mono text-ink mb-5 p-0 border-y border-line;
    }

    & :where(h2) {
        counter-increment: section;
        counter-reset: subsection;
        @apply flex flex-row items-center text-sm;

        /* Before primary headers, add a section number like 01, 02, ... */
        &::before {
            content: counter(section, decimal-leading-zero);
            @apply text-ink-tertiary text-sm px-4 py-3;
        }

        /* After primary headers, fill the remaining space with diagonal lines. */
        &::after {
            content: "";
            @apply diagonal-lines grow self-stretch border-l border-line ml-4;
        }
    }

    & :where(h3) {
        counter-increment: subsection;
        @apply flex flex-row items-center text-sm border-y-0 py-2;

        /* Subsection label before heading text. */
        &::before {
            content: counter(section, decimal-leading-zero) counter(subsection, lower-alpha);
            @apply text-ink-tertiary text-sm px-4;
        }

        /* Line after heading text, extending to the right edge. */
        &::after {
            content: "";
            @apply grow border-t border-line ml-3;
        }
    }

    /* Table styling for markdown posts.*/
    & :where(table) {
        @apply font-mono text-xs w-full border-collapse border-y border-line my-0 py-0;
    }

    & :where(tr) {
        @apply border-b border-dashed border-line;
    }

    & :where(tr:last-child) {
        @apply border-none;
    }

    & :where(tbody) {
        counter-reset: table-row;
    }

    /* Insert numbering before every row in a table. */
    & :where(tbody tr)::before {
        counter-increment: table-row;
        content: counter(table-row, decimal-leading-zero);
        display: table-cell;
        @apply text-ink-tertiary text-center w-10 border-r border-line text-xs content-center;
    }

    & :where(thead tr)::before {
        content: "";
        display: table-cell;
        @apply border-b border-r border-line;
    }

    & :where(thead th) {
        @apply p-2 text-ink border-b border-line border-r;
    }

    & :where(thead th:last-child) {
        @apply border-r-0;
    }

    & :where(td) {
        @apply border-r border-line px-2;
    }

    & :where(td:last-child) {
        @apply border-r-0;
    }

    & :where(table caption) {
        @apply text-left p-2 border-t border-line uppercase text-xs;
    }

    & :where(table caption)::before {
        counter-increment: table;
        content: "Table " counter(table, decimal-leading-zero) ". ";
        @apply text-ink-secondary;
    }
}
